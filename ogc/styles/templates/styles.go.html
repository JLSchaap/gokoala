{{- /*gotype: github.com/PDOK/gokoala/engine.TemplateData*/ -}}
{{ define "content" }}
{{ if .Config.OgcAPI.Styles }}
<hgroup>
    <h1 class="title">{{ .Config.Title }} - {{ i18n "Styles" .Language }}</h1>
</hgroup>
<div class="row">
    <div class="col-md-12">
        {{ $baseUrl := .Config.BaseURL }}
        <p>
            {{ i18n "StylesText" .Language }}
        </p>
        <table class="table table-borderless table-sm w-75">
            <tbody>
                <tr>
                    <td class="w-25">
                        <b>{{ i18n "AvailableStyles" .Language }}</b>
                    </td>
                    <td>
                        {{ if eq (len .Config.OgcAPI.Styles.SupportedStyles) 1 }}
                        {{ (index .Config.OgcAPI.Styles.SupportedStyles 0).Title }}
                        {{ else }}
                        <select id="styles">
                            {{ range $style := .Config.OgcAPI.Styles.SupportedStyles }}
                            <option value="{{ $style.ID }}">{{ $style.Title }}</option>
                            {{ end }}
                        </select>
                        {{ end }}
                    </td>
                </tr>
                {{ $language := .Language}}
                {{ range $index, $style := .Config.OgcAPI.Styles.SupportedStyles }}
                <tr id="{{ $style.ID }}_url" class="toggle-content{{ if not $index }} is-visible{{ end }}">
                    <td class="w-25">
                        <b>Style - URL</b>
                    </td>
                    <td>
                        <a href="styles/{{ $style.ID }}">{{ $baseUrl }}/styles/{{ $style.ID }}</a>
                    </td>
                </tr>
                <tr id="{{ $style.ID }}_meta" class="toggle-content{{ if not $index }} is-visible{{ end }}">
                    <td class="w-25">
                        <b>{{ i18n "StyleMetadata" $language }}</b>
                    </td>
                    <td>
                        <a href="styles/{{ $style.ID }}/metadata">Link</a>
                    </td>
                </tr>
                {{ end }}
            </tbody>
        </table>
        <p>{{ i18n "StylingExample" .Language }}:</p>
        {{ $projections := dict "EPSG:28992" "NetherlandsRDNewQuad" "EPSG:4258" "EuropeanETRS89_GRS80Quad_Draft" "EPSG:3857" "WebMercatorQuad" }}
        <app-vectortile-view id="style-vectortile-view" style="width: 800px; height: 600px;"
            tile-url="{{ $baseUrl }}/tiles/{{ get $projections (index .Config.OgcAPI.Tiles.SupportedSrs 0).Srs }}"
            style-url="{{ $baseUrl }}/styles/{{ (index .Config.OgcAPI.Styles.SupportedStyles 0).ID }}"
            zoom="{{ (index .Config.OgcAPI.Tiles.SupportedSrs 0).ZoomLevelRange.End }}" center-x="5.3896944"
            center-y="52.1562499">
        </app-vectortile-view>
    </div>
</div>
<script>
    document.addEventListener('input', function (event) {
        // only operate on styles dropdown
        if (event.target.id !== 'styles') return;
        // hide currently visible rows
        var visibleRows = document.getElementsByClassName('toggle-content is-visible');
        Array.from(visibleRows).forEach((row) => { row.classList.toggle('is-visible') });
        // make rows for newly selected style visible
        var selectedStyle = event.target.value
        var styleUrl = document.getElementById(selectedStyle + '_url');
        var styleMeta = document.getElementById(selectedStyle + '_meta');
        styleUrl.classList.toggle('is-visible');
        styleMeta.classList.toggle('is-visible');
        // update style-url in app-vectortile-view
        var viewer = document.getElementById('style-vectortile-view')
        viewer.setAttribute('style-url', '{{ .Config.BaseURL }}/styles/' + selectedStyle)
    }, false);
</script>
{{ end }}
{{ end }}
